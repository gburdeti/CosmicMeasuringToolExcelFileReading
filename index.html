<!DOCTYPE html>
<!-- xlsx.js (C) 2013-2015 SheetJS http://sheetjs.com -->
<!-- vim: set ts=2: -->
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>JS-XLSX Live Demo</title>
    <style>
        #drop {
            border: 2px dashed #bbb;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            font: 20pt bold, "Vollkorn";
            color: #bbb
        }
        
        #b64data {
            width: 100%;
        }
    </style>
</head>

<body>
    <b>JS-XLSX (XLSX/XLSB/XLSM/XLS/XML) Live Demo</b>
    <div id="drop">Drop an XLSX / XLSM / XLSB / ODS / XLS / XML file here to see sheet data</div>
    <p>
        <input type="file" name="xlfile" id="xlf" /> ... or click here to select a file
    </p>
    <!--Output is printed here-->
    <pre id="out"></pre>
    <!-- uncomment the next line here and in xlsxworker.js for encoding support -->
    <!--<script src="dist/cpexcel.js"></script>-->
    <script src="js/shim.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.full.min.js" type="text/javascript"></script>
    <!-- uncomment the next line here and in xlsxworker.js for ODS support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/ods.js" type="text/javascript"></script>
    <script>
        var X = XLSX;

        function fixdata(data) {
	        var o = "", l = 0, w = 10240;
	        for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)));
	        o+=String.fromCharCode.apply(null, new Uint8Array(data.slice(l*w)));
	        return o;
        }

function ab2str(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint16Array(data.slice(l*w)));
	return o;
}

function s2ab(s) {
	var b = new ArrayBuffer(s.length*2), v = new Uint16Array(b);
	for (var i=0; i != s.length; ++i) v[i] = s.charCodeAt(i);
	return [v, b];
}

/*function xw_noxfer(data, cb) {
	var worker = new Worker(XW.noxfer);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			case XW.msg: cb(JSON.parse(e.data.d)); break;
		}
	};
	var arr = rABS ? data : btoa(fixdata(data));
	worker.postMessage({d:arr,b:rABS});
}

function xw_xfer(data, cb) {
	var worker = new Worker(rABS ? XW.rABS : XW.norABS);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			default: xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"); console.log("done"); cb(JSON.parse(xx)); break;
		}
	};
	if(rABS) {
		var val = s2ab(data);
		worker.postMessage(val[1], [val[1]]);
	} else {
		worker.postMessage(data, [data]);
	}
}*/

function xw(data, cb) {
	transferable = document.getElementsByName("xferable")[0].checked;
	if(transferable) xw_xfer(data, cb);
	else xw_noxfer(data, cb);
}

function to_json(workbook) {
    var result = new Array();
    var sheet_name_list = workbook.SheetNames;
    sheet_name_list.forEach(function(y) { /* iterate through sheets */
        var worksheet = workbook.Sheets[y];
        
        var sheet = new Object();
        sheet.name = y;
        sheet.lines = {};

        var line = -1;
        /* iterate through cells */
        for (z in worksheet) {
            /* all keys that do not begin with "!" correspond to cell addresses */
            if(z[0] === '!') continue;
            var col = z.match(/^[A-Z]+/)[0];
            var ln = parseInt(z.match(/[1-9][0-9]*$/));
            var value = worksheet[z].v;
            
            if(line != ln){
                sheet.lines[ln] = {};
                line = ln;
            }
            sheet.lines[ln][col] = value;
            //console.log("line: %i col: %s val: %s", ln, col, value);
        }
        result.push(sheet);
    });
    
    return result;
}

function to_csv(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
		if(csv.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(csv);
		}
	});
	return result.join("\n");
}

function to_formulae(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
		if(formulae.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(formulae.join("\n"));
		}
	});
	return result.join("\n");
}

function process_wb(wb) {
    var result = to_json(wb);
    var output = JSON.stringify(result, 2, 2);
	if(out.innerText === undefined) out.textContent = output;
	else out.innerText = output;
    return result;
}

var drop = document.getElementById('drop');
function handleDrop(e) {
	e.stopPropagation();
	e.preventDefault();
	var files = e.dataTransfer.files;
	processFile(files);
}

var sheets;
function processFile(files){
    var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			var data = e.target.result;
			var	wb = X.read(data, {type: 'binary'});
			var sheets = process_wb(wb);
            // exemple de parcourt des donnees
            for(var sheet in sheets){
                console.log(sheets[sheet].name);
                /*for(var line in sheets[sheet].lines)
                    for(var col in sheets[sheet].lines[line])
                        console.log(sheets[sheet].lines[line][col]);*/
            }
		};
		reader.readAsBinaryString(f);
	}
}

function handleDragover(e) {
	e.stopPropagation();
	e.preventDefault();
	e.dataTransfer.dropEffect = 'copy';
}

if(drop.addEventListener) {
	drop.addEventListener('dragenter', handleDragover, false);
	drop.addEventListener('dragover', handleDragover, false);
	drop.addEventListener('drop', handleDrop, false);
}

var xlf = document.getElementById('xlf');
function handleFile(e) {
	var files = e.target.files;
	processFile(files);
}

if(xlf.addEventListener) xlf.addEventListener('change', handleFile, false);
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-36810333-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
    </script>
</body>

</html>