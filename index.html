<!DOCTYPE html>
<!-- xlsx.js (C) 2013-2015 SheetJS http://sheetjs.com -->
<!-- vim: set ts=2: -->
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JS-XLSX Live Demo</title>
    <style>
        #drop {
            border: 2px dashed #bbb;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            font: 20pt bold, "Vollkorn";
            color: #bbb
        }
        
        #b64data {
            width: 100%;
        }
    </style>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.2.2.min.js" integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI="
    crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"></script>
</head>

<body>
    <b>JS-XLSX (XLSX/XLSB/XLSM/XLS/XML) Live Demo</b>
    <div id="drop">Drop an XLSX / XLSM / XLSB / ODS / XLS / XML file here to see sheet data</div>
    <p>
        <input type="file" name="xlfile" id="xlf" /> ... or click here to select a file
    </p>
    <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" name="sheet_dropdown">Sheet selection
            <span class="caret"></span></button>
        <ul class="dropdown-menu" id="sheet_options">
        </ul>
    </div>
    <div>
        <b>Sheet output</b>
        <!--Sheet output is printed here-->
        <pre id="out_sheet"></pre>
    </div>
    <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" name="line_dropdown">Line selection
            <span class="caret"></span></button>
        <ul class="dropdown-menu" id="line_options">
        </ul>
    </div>
    <div>
        <b>Line output</b>
        <!--Sheet output is printed here-->
        <pre id="out_line"></pre>
    </div>
    <div>
        <b>JSON output</b>
        <!--Output is printed here-->
        <pre id="out"></pre>
    </div>
    <!-- uncomment the next line here and in xlsxworker.js for encoding support -->
    <!--<script src="dist/cpexcel.js"></script>-->
    <script src="js/shim.js" type="text/javascript"></script>
    <script src="js/xlsxprocess.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.full.min.js" type="text/javascript"></script>
    <!-- uncomment the next line here and in xlsxworker.js for ODS support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/ods.js" type="text/javascript"></script>
    <script>
        var X = XLSX;
        var sheets = null;
        var selectedSheetIndex = -1;
        var selectedLineIndex = -1;
        
        function fixdata(data) {
	        var o = "", l = 0, w = 10240;
	        for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)));
	        o+=String.fromCharCode.apply(null, new Uint8Array(data.slice(l*w)));
	        return o;
        }

        function ab2str(data) {
	        var o = "", l = 0, w = 10240;
	        for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)));
	        o+=String.fromCharCode.apply(null, new Uint16Array(data.slice(l*w)));
	        return o;
        }

        function s2ab(s) {
	        var b = new ArrayBuffer(s.length*2), v = new Uint16Array(b);
	        for (var i=0; i != s.length; ++i) v[i] = s.charCodeAt(i);
	        return [v, b];
        }

    function getSheetDropdown(){
        return $('[name="sheet_dropdown"]');
    }

    function sheetDropdownEnabled(enable){
        getSheetDropdown().prop('disabled', !enable);
    }
    
    function getLineDropdown(){
        return $('[name="line_dropdown"]');
    }

    function lineDropdownEnabled(enable){
        getLineDropdown().prop('disabled', !enable);
    }

    function xw(data, cb) {
	    transferable = document.getElementsByName("xferable")[0].checked;
	    if(transferable) xw_xfer(data, cb);
	    else xw_noxfer(data, cb);
    }

    var drop = document.getElementById('drop');
    function handleDrop(e) {
	    e.stopPropagation();
	    e.preventDefault();
	    var files = e.dataTransfer.files;
	    processFile(files);
    }

function processFile(files){
    var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			var data = e.target.result;
			var	wb = X.read(data, {type: 'binary'});
			sheets = getSheetData(wb);
            updateSheetOptions(sheets);
            selectSheet(-1);
            sheetDropdownEnabled(true);
            setOutput(sheets);
		};
		reader.readAsBinaryString(f);
	}
}

function updateSheetOptions(sheets){
    var sheetOptions = $('#sheet_options');
    sheetOptions.html("");
    for(var sheetIndex in sheets){
        sheetOptions.append("<li><a href=\"#\" data-value=\"" + sheetIndex + "\" onclick=\"selectSheet('" + sheetIndex + "')\">" + sheets[sheetIndex].name + "</a></li>");
    }
}

function selectSheet(sheetIndex) {
    event.preventDefault()
    if(selectedSheetIndex != sheetIndex)
    {
        selectedSheetIndex = sheetIndex;
        var sheetDropdown = getSheetDropdown();
        sheetDropdown.html("");
        if(selectedSheetIndex >= 0)
            sheetDropdown.append(sheets[sheetIndex].name);
        else
            sheetDropdown.append("Sheet selection");
        sheetDropdown.append("<span class=\"caret\"></span>");
        onSelectedSheetChanged();
    }
}

function onSelectedSheetChanged(){
    updateSheetOutput();
    updateLineOptions();
    selectLine(-1);
    lineDropdownEnabled(true);
}

function updateSheetOutput()
{
    var output = "";
    if(selectedSheetIndex >= 0) output = JSON.stringify(sheets[selectedSheetIndex], 2, 2);
        
    if(out_sheet.innerText === undefined)
        out_sheet.textContent = output;
	else
        out_sheet.innerText = output;
}

function updateLineOptions(){
    var lineOptions = $('#line_options');
    var selectedSheet = sheets[selectedSheetIndex];
    lineOptions.html("");
    for(var lineIndex in selectedSheet.lines){
        lineOptions.append("<li><a href=\"#\" data-value=\"" + lineIndex + "\" onclick=\"selectLine('" + lineIndex + "')\">" + lineIndex + "</a></li>");
    }
}

function selectLine(lineIndex){
    event.preventDefault();
    if(selectedLineIndex != lineIndex){
        selectedLineIndex = lineIndex;
        var lineDropdown = getLineDropdown();
        lineDropdown.html("");
        if(selectedLineIndex >= 0)
            lineDropdown.append(selectedLineIndex);
        else
            lineDropdown.append("Line selection");
        lineDropdown.append("<span class=\"caret\"></span>");
        onSelectedLineChanged();
    }
}

function onSelectedLineChanged(){
    updateLineOutput();
}

function updateLineOutput()
{
    var output = "";
    if(selectedLineIndex >= 0) output = JSON.stringify(sheets[selectedSheetIndex].lines[selectedLineIndex], 2, 2);
        
    if(out_line.innerText === undefined)
        out_line.textContent = output;
	else
        out_line.innerText = output;
}

function setOutput(data){
    // fill output with a json of the data
    var output = JSON.stringify(data, 2, 2);
	if(out.innerText === undefined) out.textContent = output;
	else out.innerText = output;
}

function handleDragover(e) {
	e.stopPropagation();
	e.preventDefault();
	e.dataTransfer.dropEffect = 'copy';
}

if(drop.addEventListener) {
	drop.addEventListener('dragenter', handleDragover, false);
	drop.addEventListener('dragover', handleDragover, false);
	drop.addEventListener('drop', handleDrop, false);
}

var xlf = document.getElementById('xlf');
function handleFile(e) {
	var files = e.target.files;
	processFile(files);
}

if(xlf.addEventListener) xlf.addEventListener('change', handleFile, false);
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-36810333-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
    
    // called when the document is ready
    $(document).ready(function(){
        sheetDropdownEnabled(false);
        lineDropdownEnabled(false);
    });
    </script>
</body>

</html>